<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<title>Command Interpolation For Dummies</title>
<meta name="author" content="Jeff Bezanson, Stefan Karpinski, Viral Shah, Alan Edelman, et al." />
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,500i,700,700i" rel="stylesheet">
<link rel="stylesheet" href="/v2/css/bootstrap.min.css" />
<link rel="stylesheet" href="/v2/css/app.css" />
<link rel="stylesheet" href="/v2/css/fonts.css" />
<link rel="stylesheet" href="/v2/css/highlight/github.css" />
</head>

<body>
  

<!-- main menu -->
<div class="container py-3 py-lg-0">
  <nav class="navbar navbar-expand-lg navbar-light bg-light" id="main-menu">

    <a class="navbar-brand" href="/" id="logo">
      <img src="/v2/img/logo.svg" height="55" width="85" />
    </a>

    <button class="navbar-toggler ml-auto hidden-sm-up float-xs-left" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <!-- li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="/">Home</a>
        </li -->
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="/downloads">Download</a>
        </li>
        <li class="nav-item flex-md-fill text-md-center">
          <a class="nav-link" href="//docs.julialang.org">Documentation</a>
        </li>
        <li class="nav-item  active  flex-md-fill text-md-center">
          <a class="nav-link" href="/blog/">Blog</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="/community">Community</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="/learning">Learning</a>
        </li>
        <li class="nav-item  flex-md-fill text-md-center">
          <a class="nav-link" href="/publications">Research</a>
        </li>
        <li class="nav-item donate flex-md-fill text-md-center">
          <a class="btn btn-success" href="https://www.flipcause.com/widget/widget_home/MjI1Nw==">Donate</a>
        </li>
      </ul>
    </div>

  </nav>
</div>
<!-- end main menu -->


<br /><br />

<div class="container">

  <div class="row">
    <div class="col-12 col-lg-8 offset-lg-2">
      <h1></h1>

<div id="blogpost">
  <h1>Command Interpolation For Dummies</h1>

  <p class="metadata">
    <span class="timestamp">05 Oct 2017</span>
    
  </p>

  <p>I’ve never been a big user of the command line. One could even say I actively avoided it!
Heck, I haven’t even written a program using command line arguments, since it always felt a bit like resurrecting a dinosaur - and we all know how that ends.</p>

<p>This carefully honed ignorance just came in handy when discussing how to improve the learning curve for Julia’s shell interface.</p>

<p>Turns out it was designed by people born in the command line, making it confusing to use for someone like me.
Now enlightened of how things work, I want to share my newly acquired knowledge!</p>

<p>Let’s start with the basics and my first mental model.
You can run a command like this:</p>
<pre><code class="language-Julia">julia&gt; run(`julia -e 'println("hello world")'`);
hello world
</code></pre>

<p>Since this looks exactly like what I would type into the terminal, I inferred that this is the general rule:
Just make it look like a command and it will run like a command!</p>

<p>But this falls apart as soon as we start interpolating into the command.
Let’s consider the following:</p>

<pre><code class="language-Julia">julia&gt; flag1 = "-e 'println(\"hello world\")'";

julia&gt; flag2 = "println(\"hello world\")";

julia&gt; helloworld = "hello world";

julia&gt; `julia $flag1`
`julia "-e 'println(\"hello world\")'"` # okay?! Guess strings get quotes

julia&gt;` julia -e 'println($helloworld)'`
`julia -e 'println($helloworld)'` #what?

julia&gt; `julia -e $flag2`
`julia -e 'println("hello world")'` # WHAT? Where are my "

julia&gt; a = "some   thing";

julia&gt; b = `some   thing`;

julia&gt; run(`echo $a`);
some   thing

julia&gt; run(`echo $b`);
some thing
</code></pre>
<p>If this all makes sense to you, welcome to the group of enlightened people!
I looked more like this:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1010467/25554703/66a7ee96-2cd4-11e7-816b-496fcef9837e.png" alt="image" /></p>

<p>Obviously this is all well thought out and what was missing is the right mental model.</p>

<p>First of all, keep in mind that there is always a <code class="highlighter-rouge">main</code> sitting somewhere, patiently waiting for you to feed it an array of strings.
The good ol’ <code class="highlighter-rouge">main(int argc,  char** argv)</code>!</p>

<p>Now, what the shell does is splitting the one command string we type in by spaces in order to pass it to this main.
This then obviously needs a method to create a string with spaces, which is where <code class="highlighter-rouge">'...'</code> or <code class="highlighter-rouge">"..."</code> comes into play.
If I understand correctly, all other characters are just conventions.
So the minus in <code class="highlighter-rouge">-e</code> isn’t treated special, as I assumed at some point.
And therefore the <code class="highlighter-rouge">-e</code> and <code class="highlighter-rouge">'println("hello world")'</code> only belong together semantically, but not when constructing the array of strings.
So trying to interpolate <code class="highlighter-rouge">'-e'</code> together with the <code class="highlighter-rouge">'...'</code> block failed miserably, since Julia tried to interpret it as one string.
What made me fail to see the correct solution was, that Julia can actually do better than the shell,
since we can directly pass an array of strings to the command.
So this actually works:</p>
<pre><code class="language-Julia">run(Cmd(["julia", "-e", "println(\"hello world\")"]))
</code></pre>
<p>Note that the above is equivalent to:</p>
<pre><code class="language-Julia">run(`julia $(["-e", """println("hello world")"""])`)
</code></pre>
<p>So we can in fact have better interpolation, since we just need to insert a new string into the array.
Which is why this actually works:
<code class="highlighter-rouge">julia -e $("println(\"hello world\"))</code>
Just leave out any <code class="highlighter-rouge">'...'</code> and let Julia turn it into a command with correctly escaped strings.</p>

<p>Now, in Julia 0.7 Keno Fischer added a way of printing that makes the array nature of a command much clearer:</p>

<p><img src="https://cloud.githubusercontent.com/assets/1010467/25554611/afa146c2-2cd1-11e7-93ac-cfc851b67133.png" alt="image" /></p>

<p>Together with a few documentation improvements, I think this can fly even for dummies like me :)</p>


</div>



</div>
</div>
</div>

<br />

<footer class="container-fluid footer-menu">
    <div class="container">
      <div class="row">
        <div class="col-lg-2 col-md-3 col-sm-4 footer-menu-item">
          <h6>Download</h6>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/downloads/index.html">Julia v1.0</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/downloads/oldreleases.html">Older</a>
            </li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 footer-menu-item">
          <h6>Documentation</h6>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="https://docs.julialang.org/en/v1/">Julia v1.0</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://docs.julialang.org/en/v1.1-dev/">Julia v1.1-dev</a>
            </li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 footer-menu-item">
          <h6>Packages</h6>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="https://juliaobserver.com">Julia Observer</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://pkg.julialang.org/pulse.html">Ecosystem Pulse</a>
            </li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 footer-menu-item">
          <h6>Community</h6>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="https://discourse.julialang.org">Discourse</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://julialang.slack.com/">Slack</a>
            </li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 footer-menu-item">
          <h6>Learning</h6>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="https://www.youtube.com/JuliaLanguage/">YouTube Channel</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://julialang.org/learning/">Other Resources</a>
            </li>
          </ul>
        </div>
        <div class="col-lg-2 col-md-3 col-sm-4 footer-menu-item">
          <h6>Research</h6>
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link" href="/publications/">Publications</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="https://julia.mit.edu/">MIT</a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <br />
  </footer>


<!-- Google Analytics -->
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-28835595-1', 'auto');
    ga('send', 'pageview');
  </script>
<!-- End Google Analytics -->

<footer class="container-fluid footer-copy">
    <div class="container">
      <div class="row">
        <div class="col-md-10 py-2">
          <p>
            Julia is a NumFocus project. We thank Fastly for their generous infrastructure support.
          </p>
          <p>
            ©2018 JuliaLang. All rights reserved.
          </p>
        </div>
        <div class="col-md-2 py-2">
          <a class="btn btn-success" href="https://www.flipcause.com/widget/widget_home/MjI1Nw==">Donate</a>
        </div>
      </div>
    </div>
  </footer>


  <script src="/v2/js/jquery.min.js"></script>
<script src="/v2/js/bootstrap.min.js"></script>
<script src="/v2/js/platform.js"></script>
<script src="/v2/js/app.js"></script>
<script src="/v2/js/highlight.pack.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
</body>

</html>
